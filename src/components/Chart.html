<svg :class ref:svg width="{{width}}" height="{{height}}">
  <g :transform>
    <rect class="chart-background" width="{{contentWidth}}"
      height="{{contentHeight}}" />
    <slot></slot>
  </g>
</svg>

<script>
  import resizeListener from "../utils/resizeListener";
  
  export default {
    namespace: "svg",
    
    oncreate() {
      this.unsubscribe = resizeListener(this.onResize.bind(this));
      this.onResize();
    },
    
    ondestroy() {
      this.unsubscribe();
    },
    
    data() {
      return {
        width: 0,
        height: 0,
        margin: {
          top: 0,
          right: 0,
          bottom: 0,
          left: 0
        }
      };
    },
    
    methods: {
      onResize() {
        const parent = this.refs.svg.parentElement,
          aspect = this.get("aspect"),
          width = parent.clientWidth,
          height = aspect ? width / aspect : parent.clientHeight;
          
        this.set({width, height});
      }
    },
    
    computed: {
      contentWidth: (width, margin) => Math.max(0, width - margin.left - margin.right),
      contentHeight: (height, margin) => Math.max(0, height - margin.top - margin.bottom),
      dimensions: (contentWidth, contentHeight) => [contentWidth, contentHeight],
      transform: (margin) => `translate(${margin.left}, ${margin.top})`
    }
  };
</script>