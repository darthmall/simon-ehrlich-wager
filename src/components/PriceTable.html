<table>
  <caption>
    Individual material prices from {{startDate}} to {{endDate}} in 1998 dollars.
  </caption>
  <thead>
    <tr>
      <th />
      <th class="numeric">Starting</th>
      <th />
      <th class="numeric">Ending</th>
      <th class="numeric">Change</th>
    </tr>
  </thead>
  <tbody>
    {{#each rows as row}}
      <tr>
        <th>{{row.key}}</th>
        <td class="numeric">
          {{dollars(first(row.values).value)}}
        </td>
        <td class="sparkline">
          <SparkLine data="{{row.values}}" />
        </td>
        
        <td class="numeric">
          {{dollars(last(row.values).value)}}
        </td>
        <td class="numeric">
          {{dollars(last(row.values).value - first(row.values).value)}}
        </td>
      </tr>
    {{/each}}
  </tbody>
</table>

<script>
  import {nest} from "d3-collection";
  import {format} from "d3-format";
  
  import SparkLine from "./SparkLine.html";
  
  export default {
    components: {
      SparkLine
    },
    
    data() {
      return {
        prices: []
      };
    },
    
    computed: {
      rows: (prices) => {
        return nest()
          .key(d => d.type)
          .sortValues((a, b) => a.year - b.year)
          .entries(prices);
      }
    },
    
    helpers: {
      first: (arr) => arr[0],
      last: (arr) => arr[arr.length - 1],
      dollars: format("$,.2f")
    }
  };
</script>